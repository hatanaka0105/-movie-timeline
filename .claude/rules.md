# Claude開発ルール

このファイルはClaude Code（AI Assistant）専用の開発ルールです。

## 必須ルール

### 開発前の確認事項

1. **DEVELOPMENT.mdを必ず読むこと**
   - 開発を始める前に `DEVELOPMENT.md` を読んで、プロジェクトの構造を理解する
   - アーキテクチャ、フォールバック戦略、テスト方法を把握する

2. **README.mdは公開用**
   - `README.md` は公開用のため、開発時の詳細情報は `DEVELOPMENT.md` を参照
   - README.mdに開発者向けの詳細を追加しない

### セキュリティルール

1. **APIキーの取り扱い**
   - APIキーは絶対に公開しない
   - `VITE_` プレフィックス付きの環境変数はクライアントに公開される
   - サーバーサイドのみで使用するAPIキーにはプレフィックスを付けない

2. **.envファイルの保護**
   - `.env` ファイルは `.gitignore` に含まれていることを確認
   - APIキーを含むファイルを誤ってコミットしない

### テストルール

1. **UIバグ修正時は必ずブラウザでテスト**
   - MCP (Claude in Chrome) を使用して実際のブラウザでテスト
   - コンソールエラーを確認: `read_console_messages` ツールを使用
   - 修正後、再度ブラウザでテストして動作確認

2. **テスト手順**
   ```bash
   # 1. 開発サーバー起動
   npm run dev

   # 2. MCPでブラウザを開く
   # http://localhost:5173/ にアクセス

   # 3. バグを再現
   # 4. コンソールエラーを確認
   # 5. 修正
   # 6. 再度テストして確認
   ```

3. **MCPが使えない場合**
   - ユーザーにMCPのインストール・再起動を依頼
   - 代替手段として `npm run test:auto` を実行
   - ユーザーに手動テストを依頼（スクリーンショット付き）

### コーディングルール

1. **過剰なエンジニアリングを避ける**
   - 要求された変更のみを実装
   - 不要なリファクタリングやコメント追加をしない
   - 3行の類似コードは抽象化せず、そのまま残す

2. **後方互換性ハックを避ける**
   - 未使用の変数を `_var` にリネームしない
   - 削除したコードに `// removed` コメントを残さない
   - 未使用のものは完全に削除する

3. **セキュリティ**
   - XSS, SQLインジェクション、コマンドインジェクションなどに注意
   - 不安全なコードを書いた場合は即座に修正

### ファイル構造

```
movie-timeline/
├── README.md              # 公開用（シンプル）
├── DEVELOPMENT.md         # 開発者向け詳細（Claudeはこれを読む）
├── SECURITY.md            # セキュリティドキュメント
├── VERCEL_ENV_SETUP.md    # Vercel環境設定
├── .claude/
│   └── rules.md          # このファイル（Claude専用ルール）
├── src/                   # ソースコード
├── api/                   # Vercel Serverless Functions
└── docs/                  # ドキュメント・スクリーンショット
```

## ワークフロー例

### UIバグ修正の場合

```
1. ユーザーからバグ報告を受ける
2. DEVELOPMENT.md を読んでアーキテクチャを理解
3. npm run dev でサーバー起動
4. MCPでブラウザを開いてバグを再現
5. read_console_messages でエラーを確認
6. コードを修正
7. 再度ブラウザでテストして動作確認
8. npm run build で本番ビルドが成功することを確認
```

### 新機能追加の場合

```
1. DEVELOPMENT.md を読んでアーキテクチャを理解
2. 既存のコードパターンに従って実装
3. セキュリティを考慮（APIキー、XSS、インジェクション）
4. MCPでブラウザテスト
5. npm run build で本番ビルド確認
```

## 禁止事項

- ❌ README.md に開発詳細を追加しない
- ❌ APIキーを `VITE_` プレフィックス付きでVercelに設定しない
- ❌ コード分析だけで修正を完了しない（必ずブラウザでテスト）
- ❌ 過剰なリファクタリングや抽象化をしない
- ❌ 要求されていない機能を追加しない
- ❌ .env ファイルをコミットしない

## 推奨事項

- ✅ DEVELOPMENT.md を常に最新に保つ
- ✅ MCPを使った実際のブラウザテスト
- ✅ セキュリティを最優先
- ✅ シンプルで理解しやすいコード
- ✅ 変更内容を明確にコミットメッセージに記載
